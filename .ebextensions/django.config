option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: ElectronicComponentWarehouseManagementSystemApp/wsgi.py:application
  aws:elasticbeanstalk:application:environment:
    DJANGO_SETTINGS_MODULE: ElectronicComponentWarehouseManagementSystemApp.settings
    PYTHONPATH: /var/app/current:$PYTHONPATH

packages:
  yum:
    git: []

container_commands:
  00_setup_debug:
    command: |
      echo "=== Starting Deployment Debug ==="
      echo "Current directory: $(pwd)"
      echo "Python path: $(which python)"
      echo "Python version: $(python --version)"
      echo "=== Listing files ==="
      ls -la
      echo "=== Django check ==="
      python -c "import django; print('Django version:', django.__version__)" || echo "Django import failed"
    leader_only: true

  01_check_database:
    command: |
      echo "=== Database Configuration Check ==="
      python -c "
      import os
      os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'ElectronicComponentWarehouseManagementSystemApp.settings')
      try:
          from django.conf import settings
          print('Settings imported successfully')
          db = settings.DATABASES['default']
          print('Database Engine:', db.get('ENGINE'))
          print('Database Name:', db.get('NAME'))
          print('Database User:', db.get('USER', 'Not set'))
          print('Database Host:', db.get('HOST', 'Not set'))
      except Exception as e:
          print('Error loading settings:', str(e))
          import traceback
          traceback.print_exc()
      "
    leader_only: true

  02_test_migration:
    command: |
      echo "=== Testing Migration ==="
      python manage.py migrate --noinput --verbosity 3
      echo "Migration exit code: $?"
    leader_only: true
    ignoreErrors: false